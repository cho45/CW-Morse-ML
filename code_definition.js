//#!/usr/bin/env node

const DEFINED_MORSE_CODES = [
	" ", // special value representing space (no coding)
	"", // reserved special value representing 'coding'

	'.',
	'-',
	'..',
	'.-',
	'-.',
	'--',
	'...',
	'..-',
	'.-.',
	'.--',
	'-..',
	'-.-',
	'--.',
	'---',
	'....',
	'...-',
	'..-.',
	'..--',
	'.-..',
	'.-.-',
	'.--.',
	'.---',
	'-...',
	'-..-',
	'-.-.',
	'-.--',
	'--..',
	'--.-',
	'---.',
	'----',
	'.....',
	'....-',
	'...-.',
	'...--',
	'..-..',
	'..-.-',
	'..--.',
	'..---',
	'.-...',
	'.-..-',
	'.-.-.',
	'.-.--',
	'.--..',
	'.--.-',
	'.---.',
	'.----',
	'-....',
	'-...-',
	'-..-.',
	'-..--',
	'-.-..',
	'-.-.-',
	'-.--.',
	'-.---',
	'--...',
	'--..-',
	'--.-.',
	'--.--',
	'---..',
	'---.-',
	'----.',
	'-----',
	'...-.-',
	'..--..',
	'..--.-',
	'.-..-.',
	'.-.-..',
	'.-.-.-',
	'.--.-.',
	'.----.',
	'-....-',
	'-..---',
	'-.-.-.',
	'-.-.--',
	'-.--.-',
	'--..--',
	'---...',
	'...-..-',
	'........',
	'...---...'
];


const DEFINED_MORSE_CODES_EN = {
	"-----": "0",
	".----": "1",
	"..---": "2",
	"...--": "3",
	"....-": "4",
	".....": "5",
	"-....": "6",
	"--...": "7",
	"---..": "8",
	"----.": "9",
	".-": "A",
	"-...": "B",
	"-.-.": "C",
	"-..": "D",
	".": "E",
	"..-.": "F",
	"--.": "G",
	"....": "H",
	"..": "I",
	".---": "J",
	"-.-": "K",
	".-..": "L",
	"--": "M",
	"-.": "N",
	"---": "O",
	".--.": "P",
	"--.-": "Q",
	".-.": "R",
	"...": "S",
	"-": "T",
	"..-": "U",
	"...-": "V",
	".--": "W",
	"-..-": "X",
	"-.--": "Y",
	"--..": "Z",
	".-.-.-": ".",
	"--..--": ",",
	"..--..": "?",
	".----.": "'",
	"-.-.--": "!",
	"-..-.": "/",
	"-.--.": "(", // KN
	"-.--.-": ")",
	".-...": "&", // AS
	"---...": ":",
	"-.-.-.": ";",
	"-...-": "=", // BT start new section
	".-.-.": "+", // AR message separator
	"-....-": "-",
	"..--.-": "_",
	".-..-.": "\"",
	"...-..-": "$",
	".--.-.": "@",
	"-.-.-": "\u0001", // CT/KA start of transmission (\u0001 = SOH)
	".-.-": "\n", // AA start new line
	"...-.-": "\u0004", // SK End of contact (\u0004 = EOT)
	"...-.": "\u0006", // SN/VE understood shift wabun to en (\u0006 = ACK)
	"...---...": "\u0014", // SOS (\u0014 = DC4)
	"........": "\u007f", // HH (\u007f = DEL)
	"-..---": "\u000F", // NJ/XM/DO en to wabun (\u000f = SI)
};

const DEFINED_MORSE_CODES_WABUN = {
	"-..---": "\u000F", // NJ/XM/DO en to wabun (\u000f = SI)
	"...-.": "\u0006", // SN/VE understood shift wabun to en (\u0006 = ACK)
	".-": "イ",
	".-.-": "ロ",
	"-...": "ハ",
	"-.-.": "ニ",
	"-..": "ホ",
	".": "ヘ",
	"..-..": "ト",
	"..-.": "チ",
	"--.": "リ",
	"....": "ヌ",
	"-.--.": "ル",
	".---": "ヲ",
	"-.-": "ワ",
	".-..": "カ",
	"--": "ヨ",
	"-.": "タ",
	"---": "レ",
	"---.": "ソ",
	".--.": "ツ",
	"--.-": "ネ",
	".-.": "ナ",
	"...": "ラ",
	"-": "ム",
	"..-": "ウ",
	".-..-": "ヰ",
	"..--": "ノ",
	".-...": "オ",
	"...-": "ク",
	".--": "ヤ",
	"-..-": "マ",
	"-.--": "ケ",
	"--..": "フ",
	"----": "コ",
	"-.---": "エ",
	".-.--": "テ",
	"--.--": "ア",
	"-.-.-": "サ",
	"-.-..": "キ",
	"-..--": "ユ",
	"-...-": "メ",
	"..-.-": "ミ",
	"--.-.": "シ",
	".--..": "ヱ",
	"--..-": "ヒ",
	"-..-.": "モ",
	".---.": "セ",
	"---.-": "ス",
	".-.-.": "ン",
	"..": "゛",
	"..--.": "゜",
	".--.-": "ー",
	".-.-.-": "、",
	".-.-..": "」",
	"-.--.-": "（",
	".-..-.": "）",
	"-----": "0",
	".----": "1",
	"..---": "2",
	"...--": "3",
	"....-": "4",
	".....": "5",
	"-....": "6",
	"--...": "7",
	"---..": "8",
	"----.": "9",
};

/*
const ALL_CODES = new Set([].concat(
	Object.keys(DEFINED_MORSE_CODES_EN),
	Object.keys(DEFINED_MORSE_CODES_WABUN)
));

const codes = Array.from(ALL_CODES.values()).sort().reverse().sort( (a, b) => a.length - b.length );
console.log(codes);
console.log(codes.length);
//*/


const fs = require('fs').promises;

(async () => {
	const sorted = DEFINED_MORSE_CODES.map( (code) => {
		size = code.split('').reduce( (r, i) => r + (i === '-' ? 4 : 2), 0)
		return { code, size }
	}).sort( (a, b) => b.size - a.size );
	const longest = sorted[0];
	const duration10wpm = 1200 / 10 * longest.size;
	console.log(`longest code: ${longest.code} (${longest.size} units) (${duration10wpm}ms/10wpm)`);

	await fs.writeFile(`DEFINITION.json`, JSON.stringify({
		DEFINED_MORSE_CODES: DEFINED_MORSE_CODES,
		EN: DEFINED_MORSE_CODES_EN,
		WABUN: DEFINED_MORSE_CODES_WABUN,
	}, null, 2));
})();
